<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembayaran QRIS - Pansa Store</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="payment-card" id="interactive-card">
        <div class="card-content">
            <div class="merchant-logo" id="merchantInitial">P</div>
            <h1 id="merchantName">Pansa Store</h1>
            <p>Masukkan jumlah pembayaran Anda</p>

            <div class="input-wrapper">
                <span>Rp</span>
                <input type="text" id="nominalInput" inputmode="numeric" placeholder="0">
            </div>

            <div class="quick-amounts">
                <button data-amount="10000">10rb</button>
                <button data-amount="25000">25rb</button>
                <button data-amount="50000">50rb</button>
                <button data-amount="100000">100rb</button>
            </div>
            <button id="bayarBtn" disabled>Bayar</button>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <span class="close-btn" id="closeBtn">&times;</span>
            <p>Total Pembayaran</p>
            <h2 id="paymentAmount"></h2>
            <div id="qrcode"></div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
      // --- BAGIAN 1: LOGIKA APLIKASI UTAMA (DARI SCRIPT.JS) ---

      // --- Referensi Elemen HTML ---
      const nominalInput = document.getElementById('nominalInput');
      const bayarBtn = document.getElementById('bayarBtn');
      const quickAmountButtons = document.querySelectorAll('.quick-amounts button');
      const merchantNameEl = document.getElementById('merchantName');
      const merchantInitialEl = document.getElementById('merchantInitial');
      const modalOverlay = document.getElementById('modalOverlay');
      const closeBtn = document.getElementById('closeBtn');
      const qrcodeContainer = document.getElementById('qrcode');
      const paymentAmountEl = document.getElementById('paymentAmount');

      // --- DATA PAYLOAD (FRONTEND-ONLY) ---
      const PAYLOAD_PART_1 = "00020101021126610014COM.GO-JEK.WWW01189360091438098430560210G8098430560303UMI51440014ID.CO.QRIS.WWW0215ID10254038798730303UMI520454995303360";
      const PAYLOAD_PART_2 = "5802ID5911Pansa Store6010BOJONEGORO61056211162070703A01";
      const MERCHANT_NAME = "Pansa Store";

      // --- Fungsi Helper ---
      const formatRupiah = (angka) => new Intl.NumberFormat('id-ID').format(angka);
      const unformatRupiah = (rupiahStr) => parseInt(String(rupiahStr).replace(/\./g, ''), 10) || 0;

      // --- FUNGSI CRC16 UNTUK VALIDASI QRIS ---
      function crc16_ccitt(data) {
          let crc = 0xFFFF;
          for (let i = 0; i < data.length; i++) {
              crc ^= data.charCodeAt(i) << 8;
              for (let j = 0; j < 8; j++) {
                  crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
              }
          }
          return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
      }

      // --- FUNGSI UTAMA UNTUK MEMBUAT QRIS ---
      function generateLocalQRIS() {
          const nominal = unformatRupiah(nominalInput.value);
          if (nominal <= 0) {
              alert("Silakan masukkan nominal yang valid.");
              return;
          }

          const amountLength = String(nominal).length.toString().padStart(2, '0');
          const amountTag = `54${amountLength}${nominal}`;
          const payloadForCrc = PAYLOAD_PART_1 + amountTag + PAYLOAD_PART_2 + "6304";
          const crcValue = crc16_ccitt(payloadForCrc);
          const finalPayload = payloadForCrc + crcValue;

          qrcodeContainer.innerHTML = "";
          new QRCode(qrcodeContainer, {
              text: finalPayload,
              width: 256,
              height: 256
          });
          
          paymentAmountEl.textContent = `Rp ${formatRupiah(nominal)}`;
          modalOverlay.classList.add('show');
      }

      function handleInputChange(event) {
          const rawValue = unformatRupiah(event.target.value);
          const formattedValue = rawValue > 0 ? formatRupiah(rawValue) : '';
          if (nominalInput.value !== formattedValue) {
              nominalInput.value = formattedValue;
          }
          bayarBtn.disabled = rawValue <= 0;
      }

      function setNominal(amount) {
          nominalInput.value = formatRupiah(amount);
          nominalInput.dispatchEvent(new Event('input'));
      }

      // --- Inisialisasi & Event Listeners ---
      document.addEventListener('DOMContentLoaded', () => {
          merchantNameEl.textContent = MERCHANT_NAME;
          merchantInitialEl.textContent = MERCHANT_NAME.charAt(0);
      });

      nominalInput.addEventListener('input', handleInputChange);
      quickAmountButtons.forEach(button => {
          button.addEventListener('click', () => setNominal(button.dataset.amount));
      });

      bayarBtn.addEventListener('click', generateLocalQRIS);
      closeBtn.addEventListener('click', () => modalOverlay.classList.remove('show'));
      modalOverlay.addEventListener('click', (event) => {
          if (event.target === modalOverlay) modalOverlay.classList.remove('show');
      });

      // --- BAGIAN 2: SCRIPT UNTUK EFEK GLOW MENGIKUTI MOUSE ---
      const card = document.getElementById('interactive-card');
      card.addEventListener('mousemove', e => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        card.style.setProperty('--mouse-x', `${x}px`);
        card.style.setProperty('--mouse-y', `${y}px`);
      });
    </script>
</body>
</html>
